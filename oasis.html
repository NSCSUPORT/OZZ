<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="logo.ico">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>OASIS API - Pagamento via MetaMask</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #ffffff;
        }

        .container {
            padding: 40px 15px;
        }

        .card {
            background-color: #1c1c1c;
            border-radius: 10px;
            margin-bottom: 30px;
            color: #ffffff;
        }

        .card-header {
            background-color: #333333;
            border-bottom: 1px solid #444444;
            font-size: 20px;
            font-weight: 500;
        }

        .btn-main {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            text-transform: uppercase;
        }

        .btn-main:hover {
            background-color: #45a049;
        }

        .btn-danger {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .card-body {
            padding: 20px;
        }

        .footer {
            width: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #f0f000, #ff4500);
            color: #000;
            text-align: center;
            font-size: 0.9rem;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000, 0 0 15px #ff0000;
            margin-top: 20px;
            animation: neon 1.5s ease-in-out infinite alternate;
        }

        .footer p {
            margin: 0;
        }

        .footer a {
            color: #000;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @keyframes neon {
            0% {
                text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000, 0 0 15px #ff0000;
            }
            50% {
                text-shadow: 0 0 20px #ff0000, 0 0 30px #ff4500, 0 0 40px #f0f000;
            }
            100% {
                text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000, 0 0 15px #ff0000;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <!-- Card de Pagamento via MetaMask -->
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="card">
                    <div class="card-header">
                        Pagar com MetaMask
                    </div>
                    <div class="card-body">
                        <p>Selecione o valor para pagar:</p>
                        <input type="number" id="paymentAmount" class="form-control mb-3" placeholder="Valor em ETH" min="0.01" step="0.01">
                        <button class="btn-main w-100" onclick="payWithMetaMask()">Pagar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 OASIS API - Todos os direitos reservados | <a href="https://holofi.vercel.app/">Sobre a tecnologia HoloFi</a></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.0.0/dist/ethers.umd.min.js"></script>
    <script>
        // Função para conectar ao MetaMask e realizar o pagamento
        async function payWithMetaMask() {
            if (typeof window.ethereum === 'undefined') {
                alert('MetaMask não detectado. Por favor, instale o MetaMask para continuar.');
                return;
            }

            const amount = document.getElementById('paymentAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert('Por favor, insira um valor válido.');
                return;
            }

            try {
                // Solicitar que o usuário se conecte ao MetaMask
                await ethereum.request({ method: 'eth_requestAccounts' });

                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const userAddress = await signer.getAddress();

                // Valor a ser pago em Wei (1 ETH = 10^18 Wei)
                const valueInWei = ethers.utils.parseEther(amount);

                // Solicitar pagamento via MetaMask
                const tx = await signer.sendTransaction({
                    to: '0xSeuEnderecoDeRecebimentoAqui',  // Substitua pelo seu endereço de recebimento
                    value: valueInWei,
                });

                console.log('Transação enviada:', tx);

                // Gerar uma chave de autorização após o pagamento
                const authorizationKey = generateAuthorizationKey(tx.hash);
                console.log('Chave de autorização:', authorizationKey);

                // Redirecionar para a página pay.html com a chave de autorização
                window.location.href = `pay.html?authKey=${authorizationKey}`;
            } catch (error) {
                console.error('Erro ao processar o pagamento:', error);
                alert('Erro ao processar o pagamento. Tente novamente.');
            }
        }

        // Função para gerar uma chave de autorização baseada no hash da transação
        function generateAuthorizationKey(txHash) {
            return btoa(txHash);  // Exemplo simples de base64 encoding
        }
    </script>
</body>
</html>
